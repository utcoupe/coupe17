<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ia/ia.class.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ia_actions.Actions.html">Actions</a><ul class='methods'><li data-type='method'><a href="ia_actions.Actions.html#actionFinished">actionFinished</a></li><li data-type='method'><a href="ia_actions.Actions.html#collision">collision</a></li><li data-type='method'><a href="ia_actions.Actions.html#doAction">doAction</a></li><li data-type='method'><a href="ia_actions.Actions.html#doNextAction">doNextAction</a></li><li data-type='method'><a href="ia_actions.Actions.html#exists">exists</a></li><li data-type='method'><a href="ia_actions.Actions.html#getNearestStartpoint">getNearestStartpoint</a></li><li data-type='method'><a href="ia_actions.Actions.html#getNormAction">getNormAction</a></li><li data-type='method'><a href="ia_actions.Actions.html#getPriorityAction">getPriorityAction</a></li><li data-type='method'><a href="ia_actions.Actions.html#importActions">importActions</a></li><li data-type='method'><a href="ia_actions.Actions.html#isDoable">isDoable</a></li><li data-type='method'><a href="ia_actions.Actions.html#isDone">isDone</a></li><li data-type='method'><a href="ia_actions.Actions.html#kill">kill</a></li><li data-type='method'><a href="ia_actions.Actions.html#parseOrder">parseOrder</a></li><li data-type='method'><a href="ia_actions.Actions.html#pathDoAction">pathDoAction</a></li></ul></li><li><a href="ia_data.Data.html">Data</a><ul class='methods'><li data-type='method'><a href="ia_data.Data.html#getDistance">getDistance</a></li><li data-type='method'><a href="ia_data.Data.html#getObjectRef">getObjectRef</a></li><li data-type='method'><a href="ia_data.Data.html#importObjects">importObjects</a></li><li data-type='method'><a href="ia_data.Data.html#isCloser">isCloser</a></li><li data-type='method'><a href="ia_data.Data.html#parseOrder">parseOrder</a></li><li data-type='method'><a href="ia_data.Data.html#theEnnemyWentThere">theEnnemyWentThere</a></li></ul></li><li><a href="ia_export_simulator.ExportSimulator.html">ExportSimulator</a><ul class='methods'><li data-type='method'><a href="ia_export_simulator.ExportSimulator.html#orderToSimu">orderToSimu</a></li><li data-type='method'><a href="ia_export_simulator.ExportSimulator.html#start">start</a></li><li data-type='method'><a href="ia_export_simulator.ExportSimulator.html#stop">stop</a></li></ul></li><li><a href="ia_gr.Gr.html">Gr</a><ul class='methods'><li data-type='method'><a href="ia_gr.Gr.html#onCollision">onCollision</a></li><li data-type='method'><a href="ia_gr.Gr.html#parseOrder">parseOrder</a></li><li data-type='method'><a href="ia_gr.Gr.html#sendOrders">sendOrders</a></li><li data-type='method'><a href="ia_gr.Gr.html#sendPos">sendPos</a></li><li data-type='method'><a href="ia_gr.Gr.html#start">start</a></li><li data-type='method'><a href="ia_gr.Gr.html#stop">stop</a></li></ul></li><li><a href="ia_ia.Ia.html">Ia</a><ul class='methods'><li data-type='method'><a href="ia_ia.Ia.html#jack">jack</a></li><li data-type='method'><a href="ia_ia.Ia.html#stop">stop</a></li></ul></li><li><a href="ia_pathfinding.Pathfinding.html">Pathfinding</a><ul class='methods'><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#getPath">getPath</a></li><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#sendDynamic">sendDynamic</a></li><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#sendQuery">sendQuery</a></li><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#updateMap">updateMap</a></li><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#~parse">parse</a></li><li data-type='method'><a href="ia_pathfinding.Pathfinding.html#~vecMultiply">vecMultiply</a></li></ul></li><li><a href="ia_timer.Timer.html">Timer</a><ul class='methods'><li data-type='method'><a href="ia_timer.Timer.html#get">get</a></li><li data-type='method'><a href="ia_timer.Timer.html#start">start</a></li><li data-type='method'><a href="ia_timer.Timer.html#status">status</a></li></ul></li><li><a href="server_server.Server.html">Server</a><ul class='methods'><li data-type='method'><a href="server_server.Server.html#launch">launch</a></li><li data-type='method'><a href="server_server.Server.html#sendNetwork">sendNetwork</a></li><li data-type='method'><a href="server_server.Server.html#sendUTCoupe">sendUTCoupe</a></li><li data-type='method'><a href="server_server.Server.html#stop">stop</a></li></ul></li><li><a href="server_server.SocketClient.html">SocketClient</a><ul class='methods'><li data-type='method'><a href="server_server.SocketClient.html#connect">connect</a></li><li data-type='method'><a href="server_server.SocketClient.html#errorServerNotFound">errorServerNotFound</a></li><li data-type='method'><a href="server_server.SocketClient.html#errorServerTimeout">errorServerTimeout</a></li><li data-type='method'><a href="server_server.SocketClient.html#order">order</a></li><li data-type='method'><a href="server_server.SocketClient.html#send">send</a></li><li data-type='method'><a href="server_server.SocketClient.html#throwError">throwError</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-config.html">config</a></li><li><a href="module-ia_actions.html">ia/actions</a></li><li><a href="module-ia_data.html">ia/data</a></li><li><a href="module-ia_export_simulator.html">ia/export_simulator</a></li><li><a href="module-ia_gr.html">ia/gr</a></li><li><a href="module-ia_ia.html">ia/ia</a></li><li><a href="module-ia_pathfinding.html">ia/pathfinding</a></li><li><a href="module-ia_pr.html">ia/pr</a></li><li><a href="module-ia_timer.html">ia/timer</a></li><li><a href="module-server_server.html">server/server</a></li><li><a href="module-server_socket_client.html">server/socket_client</a></li><li><a href="module-utcoupe_utcoupe.html">utcoupe/utcoupe</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">ia/ia.class.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * IA Module
 * 
 * @module ia/ia
 * @requires module:server/socket_client
 * @requires module:config
 * @requires module:ia/timer
 * @requires module:ia/pathfinding
 * @requires module:ia/data
 * @requires module:ia/actions
 * @requires module:ia/gr
 * @requires module:ia/pr
 * @requires module:ia/export_simulator
 * @see {@link ia/ia.Ia}
 */

module.exports = (function () {
	"use strict";
	var log4js = require('log4js');
	var logger = log4js.getLogger('ia.ia'); 
	var log_counter = 0;

	/**
	 * Return the distance between two positions
	 * 
	 * @param {int} Ax
	 * @param {int} Ay
	 * @param {int} Bx
	 * @param {int} By
	 */
	function norm(Ax, Ay, Bx, By) {
		return Math.sqrt(Math.pow(Ax-Bx, 2) + Math.pow(Ay-By, 2));
	}

	/**
	 * Constructor of Ia
	 * 
	 * @exports ia/ia.Ia
	 * @constructor
	 * @param {string} color=yellow
	 * @param {int} nb_erobots=2 Number of robots in a team
	 * @param EGR_d EGR diameter
	 * @param EGPR_d EPR diameter
	 */
	function Ia(color, nb_erobots, EGR_d, EPR_d) {
		var we_have_hats = true;
		if(!color) {
			logger.error('Please give a color to ia');
		}
		if(!nb_erobots) {
			logger.error('Please give the number of ennemis robots');
		}
		if(!we_have_hats) {
			logger.error('Please say true if we have something on our robots detectable by the Hokuyos');
		}
		if(!EGR_d) {
			logger.error('Please give the EGR diameter');
		}
		if(!EPR_d) {
			logger.error('Please give the EPR diameter');
		}
		/**
		 * Color of the IA team
		 */
		this.color = color || "yellow";
		/**
		 * Number of robots controlled by the IA
		 */
		this.nb_erobots = nb_erobots || 2;
		logger.info("Launching a "+this.color+" AI with "+this.nb_erobots+" ennemies.");
		
		/** Socket client */
		this.client = new (require('../server/socket_client.class.js'))({type: 'ia', server_ip: require('../config.js').server });
		/** Timer */
		this.timer = new (require('./timer.class.js'))(this);
		/** Pathfinding */
		this.pathfinding = new (require('./pathfinding.class.js'))(this);
		/** Data */
		this.data = new (require('./data.class.js'))(this, this.nb_erobots, EGR_d, EPR_d);
		/** Actions */
		this.actions = new (require('./actions.class.js'))(this);
		/** Grand robot */
		this.gr = new (require('./gr.class.js'))(this, this.color);
		/** Petit robot */
		this.pr = new (require('./pr.class.js'))(this, this.color);
		// this.hokuyo = new (require('./hokuyo.class.js'))(this, {
		// 	color: this.color,
		// 	nb_erobots: parseInt(this.nb_erobots),
		// 	we_have_hats: (we_have_hats === "true")
		// });
		/** Export simulator */
		this.export_simulator = new (require('./export_simulator.class.js'))(this);

		this.client.send("server", "server.iaColor", {color: this.color});

		this.client.order(function(from, name, params) {
			var classe = name.split('.')[0];
				// logger.debug(this[classe]);
			if(classe == 'ia') {
				switch(name) {
					case 'ia.jack':
						this.jack();
					break;
					case 'ia.stop':
						this.stop();
					break;
					case 'ia.hok':
						if ((log_counter++ % 15) == 0) {
							logger.debug(params);
						}
						this.pr.updatePos(params);
					break;
					case 'ia.hokfailed':
						 logger.fatal("HOKUYO NOT WORKING, UNPLUG AND REPLUG USB");
						this.pr.updatePos(params);
					break;
					default:
						logger.warn("Ordre pour l'ia inconnu : "+name);
				}
			} else if(!!this[classe]) {
				// logger.debug("Order to class: "+classe);
				if(!this[classe].parseOrder) {
					logger.warn("Attention, pas de fonction parseOrder dans ia."+classe);
				} else {
					this[classe].parseOrder(from, name, params);
				}
			} else {
				logger.warn("Sous client inconnu: "+classe);
			}
		}.bind(this));

		// temp //
		// this.gr.start();
		// this.jack();
		//////////
	}

	/**
	 * Unjack action
	 * 
	 * Starts the robots
	 */
	Ia.prototype.jack = function() {
		if(!this.timer.match_started) {
			logger.info("Démarrage du match");
			this.timer.start();
			setTimeout(function() {
				this.gr.start();
			}.bind(this), 10000);
			this.pr.start();
			// this.hokuyo.start();
		} else {
			logger.warn("Match déjà lancé");
		}
	};

	/**
	 * Stop the robots and stop the programm
	 */
	Ia.prototype.stop = function() {
		logger.fatal('Stop IA');
		this.gr.stop();
		this.pr.stop();
		// this.hokuyo.stop();
		setTimeout(process.exit, 1000);
	};

	return Ia;
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Nov 11 2016 17:47:36 GMT+0100 (CET) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
